{% extends 'base.html' %}
{% block page_title %}
    Home
{% endblock page_title %}


{% block content %}
{% load static %}
    <div class="container mx-auto w-2/6">
        <div class="infinite-container">
            {% for board in object_list %}
            <div class="infinite-item">
                {% include 'partials/board_card.html' with board=board %}
            </div>
            {% endfor %}
            </div>
            <h5>
                {% if page_obj.has_next %}
                <a class="infinite-more-link" href="?page={{page_obj.next_page_number}}"></a>
                {% endif %}
            </h5>
    </div>

    <!-- 무한 스크롤 -->
    <script src="{% static 'js/jquery.waypoints.min.js'%}"></script>
    <script src="/static/js/infinite.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
        var infinite = new Waypoint.Infinite({
            element: $('.infinite-container')[0],

            offset: 'bottom-in-view',

            onBeforePageLoad: function () {

            },
            onAfterPageLoad: function($items) {
                
            }
        });

        // 댓글창 열고 닫기
        $('.btn_toggle').click(function (e) {
          var id = $(e.currentTarget).data('id')
          $('#til'+id).toggle()
        });
      
        // 게시글 좋아요 
        $(".btn_like").click(function () {
            var pk = $(this).attr('name')
            $.ajax({
                type: "POST",
                url: "{% url 'boards:board-like' %}", 
                data: { 'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}' },
                dataType: "json",
                success: function (response) {
                    $("#count-" + pk).html(response.like_count);
                    $("#icon-" + pk).html(response.icon)
                },
                error: function (request, status, error) {
                    alert("잘못된 경로입니다.")
                    window.location.replace("/")
                },
            });
        })

        // 팔로우 기능
        $(".btn_follow").click(function () {
            var pk = $(this).attr('name')
            $.ajax({
                type: "POST",
                url: "{% url 'users:follow' %}",
                data: { 'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}' },
                dataType: "json",
                success: function (response) {
                    $("#label-" + pk).html(response.message)
                    $("#follow-count-" + pk).html("팔로워 " + response.follow_count)
                },
                error: function (request, status, error) {
                    alert("잘못된 경로입니다.")
                    window.location.replace("/")
                },
            });
        })
    </script>
{% endblock content %}
